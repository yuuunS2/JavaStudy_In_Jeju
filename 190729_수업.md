## apache tomcat 설치 및 환경설정

​	**ㄴ 과제1 : 톰캣을 사용한 간단한 방명록 만들기**

* apache 설치 방법 (mac os) - home brew 사용
  1. terminal 실행
  2. brew update 
     명령어를 사용하여 업데이트 실행
  3. brew search tomcat
     명령어를 실행하여 tomcat의 버전 리스트 확인
  4. brew install tomcat - 최신 버전 설치 
     또는 brew install [원하는 버전] - 원하는 버전 설치
  5. brew list 
     명령어로 정상적으로 설치되었는지 확인 
  6. usr/local/Cellar/tomcat 디렉토리에 tomcat 설치 완료! 
     
* apache tomcat 실행 및 종료 방법 
  1. terminal 실행
  2. cd /usr/local/Cellar/tomcat@8/8.5.42/bin 
     명령어를 통해 bin 디렉토리로 이동. 
     !! 이때 Cellar 다음 디렉토리 부터는 tomcat 버전에 따라 디렉토리가 다르니까 주의할 것!!
  3. pwd로 디렉토리 이동 잘 되었는지 확인한 후 
     ./catalina start 
     명령어 입력 ( 이 때 서버가 실행됨 )
  4. 웹을 실행한 후 주소 검색창에 
     localhost:8080 
     입력 후 접속 (apache tomcat 화면이 뜨면 정상)
  5. 서버 종료는 terminal에 
     ./catalina stop
     명령어를 입력하면 서버가 종료되고, 웹 화면에 접속이 불가능하다고 안내가 뜸! 

* Localhost Port 번호 변경하는 방법 
  1. usr⁩/⁨local⁩/⁨Cellar⁩/⁨tomcat@8⁩/8.5.42⁩/⁨libexec⁩/conf 
     디렉토리의 server.xml 파일 열기 
  2. default 값인 8080 으로 설정된 포트 번호를 변경 (여기서는 8081로 변경)
  3. 터미널에서 cd /usr/local/Cellar/tomcat@8/8.5.42/bin 디렉토리로 들어간 뒤 
     ./catalina start 
     명령어를 사용해서 다시 서버 열고, 웹 브라우저 주소 창에 localhost:8081 입력
  4. 서버가 정상 작동하는 것을 볼 수있다. 



### 강의 노트 

* 클라이언트 : 웹 브라우저 	서버 : 톰캣( Web Application Server : WAS)

  - 브라우저가 톰캣에 접속해서 서버의 파일을 다운로드 받아 보여준다. 
  - 톰캣 서버 하나에는 여러개의 Web Applicatdion이 설치 가능하다. 
    ㄴ 이것을 Context 라고 한다. 

* Context가 가져야 하는 것 : 홈 디렉토리, 접근 경로 

* 환경설정? 해주기 

  1. Users/yunhee/StudyHome 폴더 생성. (mkdir Users/yunhee/StudyHome)
     Users/yunhee/StudyHome/WEB-INF
     Users/yunhee/StudyHome/WEB-INF/classes
     Users/yunhee/StudyHome/WEB-INF/lib
     총 4개의 폴더를 생성한다. 

  - 클라이언트는 홈 디렉토리 아래의 모든 파일을 다운 가능하다. 
    단, WEB-INF 는 접근이 불가능하다. ( 그래서 이 폴더에 내부 설정파일 등을 둔다 )
  - classes : java class 파일을 놓는 곳 
    lib : 동작에 필요한 jar 파일을 놓는 곳


  2. copy usr⁩ ▸ ⁨local⁩ ▸ ⁨Cellar⁩ ▸ ⁨tomcat@8⁩ ▸ ⁨8.5.42⁩ ▸ ⁨libexec⁩ ▸ ⁨webapps⁩ ▸ ⁨ROOT⁩ ▸ WEB-INF 폴더의 web.xml 복사해서 Users/yunhee/StudyHome/WEB-INF 디렉토리에 넣어준다. 
     
  3. 옮겨준 web.xml 파일의 주석 삭제, web-app 부분만 남기고 지우기

  ```xml
  <?xml version="1.0" encoding="UTF-8"?>
  <web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee
                        http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"
    version="3.1"
    metadata-complete="true">
  </web-app>
  ```

  4. 다시 server.xml 파일 열어서 localhost 위치 뒤에 ( 148 line )
     <Context>...</Context> 추가 

  ```xml
  <Host name="localhost"  appBase="webapps"
              unpackWARs="true" autoDeploy="true">
        <Context docBase="/Users/yunhee/StudyHome/" 		path="/study" reloadable="true"></Context>
  
  ```

  ㄴ 이 작업이 끝나고 다시 서버를 열어본다. 이때 서버가 제대로 작동 안하면 어디선가 잘못된거,,, 도르륵

  5. /Users/yunhee/StudyHome/ 디렉토리에  test.html 파일 생성

  ```html
  <html>
  	<body>HelloWorld : ^^*</body>
  </html>
  ```

  ㄴ 다시 서버를 열어서 웹 주소창에 
  192.168.2.49:8081/study/test.html
  "ip주소:port번호/study/test.html" 입력해주면 test.html이 실행된다. 

  - 동작 순서 
    — 그림 — 

  6. /Users/yunhee/StudyHome/apple/ 디렉토리에 test.html 파일 복사 
     ㄴ 192.168.2.49:8081/study/apple/test.html 주소창에 입력하면 실행됨
     "docBase (sever.xml에서 설정해 준 것) 디렉토리 하위 폴더의 파일은 폴더명을 경로명으로 바꾸어 접속할 수 있다."

  7. /Users/yunhee/StudyHome/WEB-INF/ 디렉토리 에 test.html 파일 복사

     ㄴ192.168.2.49:8081/study/WEB-INF/test.html
     "WEB-INF 폴더는 특수한 폴더( 브라우저에 공개되지 않는 폴더 )이므로 404오류가 나타난다. "

  8. tomcat/lib/servlet-api.jar 파일을 
     Users/yunhee/JavaWork2 아래로 복사한다.  ( 절대 ext 폴더에 넣지 마시오. )

  9. HelloWorld2.java 만들기 

     ```java
     package apple;
     
     import javax.servlet.http.HttpServlet;
     import javax.servlet.ServletException;
     import java.io.IOException;
     import jacvax.servlet.http.HttpServletRequest;
     import javax.servlet.http.HttpServletResponse;
     
     public class HelloWorld2 extends HttpServlet{
     	public void service(HttpServletRequest request,
     		HttpServletResponse response ) 
     		throws IOException, ServletException{
     
     		System.out.println("HelloWorld2");
     	}
     }
     ```

  10. /Users/yunhee/StudyHome/WEB-INF/ 디렉토리의 web.xml 열어서 수정

      ```xml
      <?xml version="1.0" encoding="UTF-8"?>
      <web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee
                            http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"
        version="3.1"
        metadata-complete="true">
        <!--
        	this is comment of xml files
        -->
        <servlet>
        	<servlet-name>abcd</servlet-name>
        	<servlet-class>apple.HelloWorld2</servlet-class>
        </servlet>
      
        <servlet-mapping>
        	<servlet-name>abcd</servlet-name>
        	<url-pattern>/study01</url-pattern>	
        </servlet-mapping>
      </web-app>
      ```

  11. 



*  서블릿의 동작 흐름

  0. WAS 쪽에 적절히 설정이 되어있다고 가정한다. 

  1. 브라우저에서 /study/study01으로 요청이 들어온다.

  2. /study 로 경로를 설정한 Context가 있나? - 있음

  3. 2 에서 찾은 context 의 docBase 폴더 아래의 /WEB-INF/web.xml 찾음

  4. 거기의 url-pattern 중 /study01 에 해당하는 설정? - 있음

     ㄴ 이것은 어떤 서블릿 이름을 지명하나 ? - abcd

  5. abcd 로 이름 붙여진 서블릿 클래스가 있나? apple.HElloWorld2

  6. apple.HelloWorld2 을 찾아 _-> 인스턴스 생성 -> 오버라이딩 항는 service  함수를 호출한다,. 

  7. system.out.println("HelloWorld2 : ^^") ; 은 서버쪽에 찍히고

  8. PrintWriter out = response.getWriter();를 이용하여 내보내는 것은 
     요청으로 들어온 브라우저 쪽으로 내보내진다. 

  9. 요청했던 브라우저는 응답으로 전달된 내용을 받아 화면에 출력한다. 

* 이클립스 설정
  server runtime enviroment -> tomcat 8.5 -> 
  jre -> 7 or 8 버전으로 